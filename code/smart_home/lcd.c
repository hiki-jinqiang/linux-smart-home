#include "lcd.h"

//智
unsigned char zhi[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
                       0x03, 0x03, 0x00, 0x10, 0x03, 0xFF, 0x9F, 0xF8, 0x06, 0x30, 0x18, 0x30, 0x04, 0x30, 0x18, 0x30,
                       0x08, 0x30, 0x18, 0x30, 0x00, 0x30, 0x18, 0x30, 0x00, 0x21, 0x98, 0x30, 0x3F, 0xFF, 0xD8, 0x30,
                       0x00, 0x60, 0x18, 0x30, 0x00, 0x70, 0x18, 0x30, 0x00, 0x4C, 0x1F, 0xF0, 0x00, 0xC7, 0x18, 0x30,
                       0x01, 0x83, 0x98, 0x30, 0x03, 0x01, 0x80, 0x00, 0x06, 0x00, 0x80, 0x00, 0x18, 0x7F, 0xFF, 0xC0,
                       0x20, 0x60, 0x01, 0x80, 0x00, 0x60, 0x01, 0x80, 0x00, 0x60, 0x01, 0x80, 0x00, 0x7F, 0xFF, 0x80,
                       0x00, 0x60, 0x01, 0x80, 0x00, 0x60, 0x01, 0x80, 0x00, 0x60, 0x01, 0x80, 0x00, 0x60, 0x01, 0x80,
                       0x00, 0x7F, 0xFF, 0x80, 0x00, 0x60, 0x01, 0x80, 0x00, 0x40, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00};

//能
unsigned char neng[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x30, 0x00,
                        0x00, 0xC0, 0x38, 0x00, 0x01, 0x80, 0x30, 0x40, 0x03, 0x08, 0x30, 0xE0, 0x06, 0x06, 0x31, 0xC0,
                        0x0C, 0x07, 0x37, 0x00, 0x38, 0x1F, 0x38, 0x00, 0x1F, 0xE3, 0x30, 0x08, 0x10, 0x01, 0x30, 0x08,
                        0x08, 0x04, 0x30, 0x08, 0x0F, 0xFE, 0x18, 0x1C, 0x0C, 0x04, 0x1F, 0xF8, 0x0C, 0x04, 0x00, 0x00,
                        0x0C, 0x04, 0x00, 0x00, 0x0F, 0xFC, 0x30, 0x00, 0x0C, 0x04, 0x30, 0x60, 0x0C, 0x04, 0x30, 0xF0,
                        0x0C, 0x04, 0x31, 0xC0, 0x0C, 0x04, 0x33, 0x00, 0x0F, 0xFC, 0x3C, 0x00, 0x0C, 0x04, 0x30, 0x08,
                        0x0C, 0x04, 0x30, 0x08, 0x0C, 0x04, 0x30, 0x08, 0x0C, 0x04, 0x30, 0x08, 0x0C, 0x04, 0x30, 0x08,
                        0x0C, 0xFC, 0x3F, 0xFC, 0x0C, 0x1C, 0x1F, 0xF8, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

//家
unsigned char jia[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x03, 0x80, 0x00,
                       0x00, 0x01, 0x80, 0x00, 0x04, 0x00, 0x80, 0x10, 0x07, 0xFF, 0xFF, 0xF8, 0x04, 0x00, 0x00, 0x38,
                       0x0C, 0x00, 0x00, 0x20, 0x18, 0x00, 0x03, 0x40, 0x01, 0xFF, 0xFF, 0x80, 0x00, 0x06, 0x00, 0x00,
                       0x00, 0x0C, 0x00, 0x00, 0x00, 0x1A, 0x01, 0x80, 0x00, 0x33, 0x03, 0xC0, 0x00, 0xC1, 0x86, 0x00,
                       0x03, 0x03, 0x98, 0x00, 0x0C, 0x06, 0xE8, 0x00, 0x10, 0x0C, 0x44, 0x00, 0x00, 0x30, 0xE4, 0x00,
                       0x00, 0x61, 0xE6, 0x00, 0x01, 0x83, 0xE2, 0x00, 0x06, 0x07, 0x23, 0x00, 0x18, 0x0C, 0x21, 0x80,
                       0x00, 0x18, 0x20, 0xE0, 0x00, 0x60, 0x20, 0x78, 0x00, 0xC0, 0x60, 0x38, 0x07, 0x00, 0x60, 0x10,
                       0x18, 0x0F, 0xE0, 0x00, 0x20, 0x03, 0xC0, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00};

//居
unsigned char ju[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x20,
                      0x03, 0xFF, 0xFF, 0xF0, 0x03, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00, 0x60, 0x03, 0x00, 0x00, 0x60,
                      0x03, 0x00, 0x00, 0x60, 0x03, 0xFF, 0xFF, 0xE0, 0x03, 0x00, 0x40, 0x60, 0x03, 0x00, 0x60, 0x00,
                      0x03, 0x00, 0x60, 0x00, 0x03, 0x00, 0x60, 0x00, 0x03, 0x00, 0x60, 0x18, 0x03, 0xFF, 0xFF, 0xFC,
                      0x03, 0x00, 0x60, 0x00, 0x02, 0x00, 0x60, 0x00, 0x02, 0x00, 0x60, 0x00, 0x02, 0x00, 0x60, 0x00,
                      0x06, 0x20, 0x60, 0xC0, 0x06, 0x3F, 0xFF, 0xE0, 0x06, 0x30, 0x00, 0xC0, 0x04, 0x30, 0x00, 0xC0,
                      0x0C, 0x30, 0x00, 0xC0, 0x08, 0x30, 0x00, 0xC0, 0x08, 0x30, 0x00, 0xC0, 0x10, 0x30, 0x00, 0xC0,
                      0x10, 0x3F, 0xFF, 0xC0, 0x20, 0x30, 0x00, 0xC0, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_0[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xC0, 0x06, 0x20,
                          0x0C, 0x30, 0x18, 0x18, 0x18, 0x18, 0x18, 0x08, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C,
                          0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x18, 0x08, 0x18, 0x18,
                          0x18, 0x18, 0x0C, 0x30, 0x06, 0x20, 0x03, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_1[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x80,
                          0x1F, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80,
                          0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80, 0x01, 0x80,
                          0x01, 0x80, 0x01, 0x80, 0x03, 0xC0, 0x1F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_2[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xE0, 0x08, 0x38,
                          0x10, 0x18, 0x20, 0x0C, 0x20, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x00, 0x0C, 0x00, 0x18, 0x00, 0x18,
                          0x00, 0x30, 0x00, 0x60, 0x00, 0xC0, 0x01, 0x80, 0x03, 0x00, 0x02, 0x00, 0x04, 0x04, 0x08, 0x04,
                          0x10, 0x04, 0x20, 0x0C, 0x3F, 0xF8, 0x3F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_3[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xC0, 0x18, 0x60,
                          0x30, 0x30, 0x30, 0x18, 0x30, 0x18, 0x30, 0x18, 0x00, 0x18, 0x00, 0x18, 0x00, 0x30, 0x00, 0x60,
                          0x03, 0xC0, 0x00, 0x70, 0x00, 0x18, 0x00, 0x08, 0x00, 0x0C, 0x00, 0x0C, 0x30, 0x0C, 0x30, 0x0C,
                          0x30, 0x08, 0x30, 0x18, 0x18, 0x30, 0x07, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_4[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x60,
                          0x00, 0xE0, 0x00, 0xE0, 0x01, 0x60, 0x01, 0x60, 0x02, 0x60, 0x04, 0x60, 0x04, 0x60, 0x08, 0x60,
                          0x08, 0x60, 0x10, 0x60, 0x30, 0x60, 0x20, 0x60, 0x40, 0x60, 0x7F, 0xFC, 0x00, 0x60, 0x00, 0x60,
                          0x00, 0x60, 0x00, 0x60, 0x00, 0x60, 0x03, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_5[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFC, 0x0F, 0xFC,
                          0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x13, 0xE0, 0x14, 0x30,
                          0x18, 0x18, 0x10, 0x08, 0x00, 0x0C, 0x00, 0x0C, 0x00, 0x0C, 0x00, 0x0C, 0x30, 0x0C, 0x30, 0x0C,
                          0x20, 0x18, 0x20, 0x18, 0x18, 0x30, 0x07, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_6[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xE0, 0x06, 0x18,
                          0x0C, 0x18, 0x08, 0x18, 0x18, 0x00, 0x10, 0x00, 0x10, 0x00, 0x30, 0x00, 0x33, 0xE0, 0x36, 0x30,
                          0x38, 0x18, 0x38, 0x08, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x18, 0x0C,
                          0x18, 0x08, 0x0C, 0x18, 0x0E, 0x30, 0x03, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_7[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFC, 0x1F, 0xFC,
                          0x10, 0x08, 0x30, 0x10, 0x20, 0x10, 0x20, 0x20, 0x00, 0x20, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40,
                          0x00, 0x80, 0x00, 0x80, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x03, 0x00, 0x03, 0x00,
                          0x03, 0x00, 0x03, 0x00, 0x03, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_8[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xE0, 0x0C, 0x30,
                          0x18, 0x18, 0x30, 0x0C, 0x30, 0x0C, 0x30, 0x0C, 0x38, 0x0C, 0x38, 0x08, 0x1E, 0x18, 0x0F, 0x20,
                          0x07, 0xC0, 0x18, 0xF0, 0x30, 0x78, 0x30, 0x38, 0x60, 0x1C, 0x60, 0x0C, 0x60, 0x0C, 0x60, 0x0C,
                          0x60, 0x0C, 0x30, 0x18, 0x18, 0x30, 0x07, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char data_9[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xC0, 0x18, 0x20,
                          0x30, 0x10, 0x30, 0x18, 0x60, 0x08, 0x60, 0x0C, 0x60, 0x0C, 0x60, 0x0C, 0x60, 0x0C, 0x60, 0x0C,
                          0x70, 0x1C, 0x30, 0x2C, 0x18, 0x6C, 0x0F, 0x8C, 0x00, 0x0C, 0x00, 0x18, 0x00, 0x18, 0x00, 0x10,
                          0x30, 0x30, 0x30, 0x60, 0x30, 0xC0, 0x0F, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char *title[] = {zhi, neng, jia, ju};
unsigned char *data_array[] = {data_0, data_1, data_2, data_3, data_4, data_5, data_6, data_7, data_8, data_9};

int Lcd_fd = -1;           //屏幕文件的描述符  全局变量
unsigned int *plcd = NULL; //全局映射首地址
int album[7] = {0};

//初始化屏幕
void Lcdinit()
{
    Lcd_fd = open("/dev/fb0", O_RDWR);
    if (-1 == Lcd_fd)
    {
        perror("open lcd error");
        exit(0);
    }
    plcd = mmap(NULL, 800 * 480 * 4,
                PROT_READ | PROT_WRITE,
                MAP_SHARED,
                Lcd_fd,
                0);
    if (plcd == NULL)
    {
        perror("mmap error");
        exit(1);
    }
}

//画点函数
void display(int x, int y, unsigned int color)
{
    if (x >= 0 && x < 800 && y >= 0 && y < 480)
    {
        *(plcd + y * 800 + x) = color;
    }
}

//加载相册
void LoadBmp()
{
    int fd = 0;
    //打开文件
    fd = open("./1.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[0] = fd;
    //关闭文件
    close(fd);
    fd = 0;
    fd = open("./2.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[1] = fd;
    //关闭文件
    close(fd);
    fd = 0;
    fd = open("./3.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[2] = fd;
    //关闭文件
    close(fd);
    fd = 0;
    fd = open("./4.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[3] = fd;
    //关闭文件
    close(fd);
    fd = 0;
    fd = open("./5.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[4] = fd;
    //关闭文件
    close(fd);
    fd = 0;
    fd = open("./6.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[5] = fd;
    //关闭文件
    close(fd);
    fd = 0;
    fd = open("./7.bmp", O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }
    album[6] = fd;
    //关闭文件
    close(fd);
}

//显示一个图片
void DisplayBmp(int order)
{
    int width, height;
    short depth;
    //提取数据
    //将偏移量偏移到宽度这里
    lseek(album[order], 0x12, SEEK_SET);
    read(album[order], &width, 4);  //读取之后会自动往后偏移四个字节
    read(album[order], &height, 4); //读的高度

    //偏移到色深这里
    lseek(album[order], 0x1c, SEEK_SET);
    read(album[order], &depth, 2);
    printf("%d   %d    %d\n", width, height, depth);

    //显示图片
    //拿到每一个像素的值
    //将像素数组的大小给算出来
    //首先我们要计算补充的字节数

    int n = (4 - (width * depth / 8) % 4) % 4;

    //开辟像素数组的空间
    unsigned char colorbuf[(width * depth / 8 + n) * height];

    //将像素数组整体读过来
    lseek(album[order], 0x36, SEEK_SET);
    read(album[order], colorbuf, (width * depth / 8 + n) * height);

    unsigned int color;
    unsigned char c_a = 0, c_r, c_g, c_b;
    int i = 0;
    int x, y;

    for (y = height - 1; y >= 0; y--)
    {
        for (x = 0; x < width; x++)
        {
            c_b = colorbuf[i++];
            c_g = colorbuf[i++];
            c_r = colorbuf[i++];

            if (depth == 32) //有透明度
            {
                c_a = colorbuf[i++];
            }

            color = c_a << 24 | c_r << 16 | c_g << 8 | c_b;
            display(x, y, color);
        }
        i += n; //将后面补充的字节数哪些没用的全部跳过
    }
}

//打开一个图片
void OpenBmpAndDisplay(const char *pathame)
{
    //打开文件
    int fd = open(pathame, O_RDONLY);
    if (-1 == fd)
    {
        perror("open bmp error");
        return;
    }

    int width, height;
    short depth;
    //提取数据
    //将偏移量偏移到宽度这里
    lseek(fd, 0x12, SEEK_SET);
    read(fd, &width, 4);  //读取之后会自动往后偏移四个字节
    read(fd, &height, 4); //读的高度

    //偏移到色深这里
    lseek(fd, 0x1c, SEEK_SET);
    read(fd, &depth, 2);
    printf("%d   %d    %d\n", width, height, depth);

    //显示图片
    //拿到每一个像素的值
    //将像素数组的大小给算出来
    //首先我们要计算补充的字节数

    int n = (4 - (width * depth / 8) % 4) % 4;

    //开辟像素数组的空间
    unsigned char colorbuf[(width * depth / 8 + n) * height];

    //将像素数组整体读过来
    lseek(fd, 0x36, SEEK_SET);
    read(fd, colorbuf, (width * depth / 8 + n) * height);

    unsigned int color;
    unsigned char c_a = 0, c_r, c_g, c_b;
    int i = 0;
    int x, y;

    for (y = height - 1; y >= 0; y--)
    {
        for (x = 0; x < width; x++)
        {
            c_b = colorbuf[i++];
            c_g = colorbuf[i++];
            c_r = colorbuf[i++];

            if (depth == 32) //有透明度
            {
                c_a = colorbuf[i++];
            }

            color = c_a << 24 | c_r << 16 | c_g << 8 | c_b;
            display(x, y, color);
        }
        i += n; //将后面补充的字节数哪些没用的全部跳过
    }
    //关闭文件
    close(fd);
}

//画一个矩形
void DisplaySql(int w, int h, int x0, int y0, unsigned int color)
{
    int x, y;
    for (y = 0; y < h; y++)
    {
        for (x = 0; x < w; x++)
        {
            display(x + x0, y + y0, color);
        }
    }
}

//显示字模
void DisplayZimo(unsigned char *zimo, int w, int h, int x0, int y0, unsigned int color)
{
    int i;
    int x, y;
    for (i = 0; i < w * h / 8; i++)
    {
        int k;
        for (k = 7; k >= 0; k--)
        {
            if (zimo[i] & (1 << k))
            {
                x = (i % (w / 8) * 8) + (7 - k);
                y = i / (w / 8);
                display(x + x0, y + y0, color);
            }
        }
    }
}

//显示数字在屏幕
void DisplayData(int value, int i)
{
    int j, c = 0, z = 0;
    char databuf[10] = {0};
    while (1)
    {
        databuf[c] = value % 10;
        value = value / 10;
        c++;
        if (value == 0)
        {
            break;
        }
    }
    // printf("c=%d\n", c);
    if (i == 1)
    {
        DisplaySql(400, 32, 0, 60, 0x000000);
        for (j = 0; j < c; j++)
        {
            // printf("%d\n", databuf[j]);
            DisplayZimo(data_array[databuf[j]], 16, 32, 296 - 16 * z, 60, 0xffffff);
            z++;
        }
    }
    else if (i == 2)
    {
        DisplaySql(400, 32, 400, 60, 0x000000);
        for (j = 0; j < c; j++)
        {
            // printf("%d\n", databuf[j]);
            DisplayZimo(data_array[databuf[j]], 16, 32, 696 - 16 * z, 60, 0xffffff);
            z++;
        }
    }
    else if (i == 3)
    {
        DisplaySql(400, 32, 0, 220, 0x000000);
        for (j = 0; j < c; j++)
        {
            // printf("%d\n", databuf[j]);
            DisplayZimo(data_array[databuf[j]], 16, 32, 296 - 16 * z, 220, 0xffffff);
            z++;
        }
    }
    else if (i == 4)
    {
        DisplaySql(400, 32, 400, 220, 0x000000);
        for (j = 0; j < c; j++)
        {
            // printf("%d\n", databuf[j]);
            DisplayZimo(data_array[databuf[j]], 16, 32, 696 - 16 * z, 220, 0xffffff);
            z++;
        }
    }
    else if (i == 5)
    {
        DisplaySql(400, 32, 0, 380, 0x000000);
        for (j = 0; j < c; j++)
        {
            // printf("%d\n", databuf[j]);
            DisplayZimo(data_array[databuf[j]], 16, 32, 296 - 16 * z, 380, 0xffffff);
            z++;
        }
    }
    else if (i == 6)
    {
        DisplaySql(400, 32, 400, 380, 0x000000);
        for (j = 0; j < c; j++)
        {
            // printf("%d\n", databuf[j]);
            DisplayZimo(data_array[databuf[j]], 16, 32, 696 - 16 * z, 380, 0xffffff);
            z++;
        }
    }
}

//画菜单
void Menu()
{
    DisplaySql(800, 480, 0, 0, 0x000000);
    DisplaySql(200, 100, 100, 60, 0x55E219);
    DisplaySql(200, 100, 520, 60, 0x23D4EF);
    DisplaySql(200, 100, 100, 300, 0xFFFB00);
    DisplaySql(200, 100, 520, 300, 0xFFFFFF);
}

//屏幕的销毁
void LcdDestory()
{
    //解除映射
    munmap(plcd, 800 * 480 * 4);
    //关闭文件
    close(Lcd_fd);
}
